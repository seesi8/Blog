<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    <%= article.title %>
  </title>
  <!--Owl-Carousel-->
  <link rel="stylesheet" href="/CSS/owl.carousel.min.css">
  <link rel="stylesheet" href="/CSS/owl.theme.default.min.css">

  <!--AOS Lib-->
  <link rel="stylesheet" href="./CSS/aos.css">

  <!--font awesome-->
  <link rel="stylesheet" href="/CSS/all.css">
  <!--font awesome-->
  <link rel="stylesheet" href="/CSS/nav.css">
  <!--custom css-->
  <link rel="stylesheet" href="/CSS/Show.css">

</head>

<body>
  <!--Nav-->
  <nav class="nav">
    <%- include('_nav') %>
  </nav>

  <!--Nav end-->
  <main>
    <div class="container">

      <div class="title">
        <div class="title-img">
          <img src="\images\<%=article.multerphoto %>" class="img-title">
          <div class="img-complications">
            <%= article.createdAt.toLocaleDateString() %>
              <a href="/articles/password/edit/<%= article.id %>" class="complication">Edit</a>
              <button type="submit"><i class="fa-regular fa-heart "></i></button>
              <button type="submit"><i class="fa-solid fa-heart hide"></i></button>
              <div class="popmin">
                <%= article.pop %>
              </div>
              <div class="popadd hide">
                <%= article.pop + 1 %>
              </div>
          </div>
          <div class="danger-parent">
            <div class="danger-alert">
              <span class="closebtn" onclick="">&times;</span>
              <p></p>
            </div>
          </div>

        </div>

        <div class="title-child">
          <h1 class="">
            <%= article.Title %>
          </h1>
          <div class="title-complications">
            <%= article.createdAt.toLocaleDateString() %>
              <a href="/articles/password/edit/<%= article.id %>" class="complication">Edit</a>
              <button type="submit"><i class="fa-regular fa-heart "></i></button>
              <button type="submit"><i class="fa-solid fa-heart hide"></i></button>
              <%= article.pop %>
                <%= article.pop %>
          </div>
          <h3 class="description">
            <%= article.Description %>
          </h3>
        </div>
      </div>

      <div class="main-text">
        <div class="body-text">
          <%- article.sanitizedHtml %>
        </div>
      </div>


    </div>

  </main>
</body>
<%- include('_footer')%>
<script src="/Js/Jquery_3.6.0.min.js"></script>

<!--Owl-Carousel-->
<script src="/Js/owl.carousel.min.js"></script>

<!--AOS Lib-->
<script src="/Js/aos.js"></script>

<!-- Custom Js-->
<script src="/Js/global.js"></script>
<script src="/Js/Show.js"></script>
<script>

  $nav = $('.nav');
  $solid = $('.fa-solid.fa-heart');
  $regular = $('.fa-regular.fa-heart');
  $toggleCollapse = $('.toggle-collapse');
  $added = $('.popadd');
  $noadded = $('.popmin');
  $danger = $('.danger-alert p');

  function like() {
    $regular.toggleClass('hide');
    $solid.toggleClass('hide');
    $added.toggleClass('hide');
    $noadded.toggleClass('hide');
  }

  function onstart() {
    var user = <%- JSON.stringify(user.likedposts) %>;
    if ("<%=user.username%>" != "No User") {
      console.log("step 2")
      console.log(user)
      console.log(user.includes("<%= article.id%>"))
      if (user.includes("<%= article.id%>")) {
        like()
      }
    }
  };

  onstart()

  $('.fa-regular.fa-heart').click(function () {
    $regular.toggleClass('hide');
    $solid.toggleClass('hide');
    $added.toggleClass('hide');
    $noadded.toggleClass('hide');
    console.log("running");
    fetch("/articles/popplus/<%= article.id%>/plus", {
      method: 'POST',
      mode: 'cors',
      cache: 'default',
      body: JSON.stringify(null)
    }).then(response => {
      if (response.ok) {
        return response.json();
      }
    }).then(data => {
      if (data || data != "done") {
        $danger.text(data.errormsg)
        if (data.errormsg) {
          $danger.parent().toggleClass('hide')
          console.log("nothing")
        }
      }
    }).catch(err => console.error(err));
  })

  $('.fa-solid.fa-heart').click(function () {
    $regular.toggleClass('hide');
    $solid.toggleClass('hide');
    $added.toggleClass('hide');
    $noadded.toggleClass('hide');
    console.log("running");
    fetch("/articles/popplus/<%= article.id%>/minus", {
      method: 'POST',
      mode: 'cors',
      cache: 'default',
      body: JSON.stringify(null)
    }).then(response => {
      if (response.ok) {
        return response.json();
      }
    }).then(data => {
      if (data || data != done) {
        $danger.text(data.errormsg)
        if (data.errormsg) {
          $danger.parent().toggleClass('hide')
          console.log("nothing")
        }
      }
    }).catch(err => console.error(err));
  })



</script>

</html>